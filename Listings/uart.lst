C51 COMPILER V9.54   UART                                                                  10/21/2025 15:22:00 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\Objects\uart.obj
COMPILER INVOKED BY: D:\Keil5\C51\BIN\C51.EXE Hardware\uart.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\System;.\src;.\Hardware)
                    - DEBUG OBJECTEXTEND PRINT(.\Listings\uart.lst) OBJECT(.\Objects\uart.obj)

line level    source

   1          #include "uart.h"
   2          
   3          unsigned char ostart;
   4          unsigned char oend;
   5          char idata outbuf[OLEN];
   6          
   7          unsigned char istart;
   8          unsigned char iend;
   9          char idata inbuf[ILEN];
  10          bit bdata sendfull;
  11          bit bdata sendactive;
  12          
  13          /*串行中断服务程序*/
  14          static void com_isr(void) interrupt 4 using 1        //串口中断
  15          { 
  16   1         //-------------接收数据中断--------------
  17   1        char c;
  18   1        if(RI)
  19   1        { 
  20   2          c=SBUF;
  21   2          RI=0;
  22   2          if(istart+ILEN!=iend)
  23   2          { 
  24   3            inbuf[iend++&(ILEN-1)]=c; 
  25   3          }
  26   2        }
  27   1      
  28   1        //-------------发送数据中断--------------
  29   1        if(TI)
  30   1        { 
  31   2          TI=0;
  32   2          if(ostart!=oend)
  33   2          {  
  34   3             SBUF=outbuf[ostart++&(OLEN-1)];
  35   3             sendfull=0;
  36   3           }
  37   2           else
  38   2           { 
  39   3              sendactive=0; 
  40   3           }
  41   2         }
  42   1      }   
  43          
  44          //PUTBUF: 写字符到SBUF或发送缓冲区
  45          void putbuf(char c)
  46          { 
  47   1          if(!sendfull)
  48   1          {
  49   2            if(!sendactive)
  50   2            { 
  51   3                sendactive=1;
  52   3                SBUF=c;
  53   3            }
  54   2            else 
C51 COMPILER V9.54   UART                                                                  10/21/2025 15:22:00 PAGE 2   

  55   2            { 
  56   3              ES=0;
  57   3              outbuf[oend++&(OLEN-1)]=c;
  58   3              if(((oend^ostart)&(OLEN-1))==0)
  59   3               { sendfull=1;}
  60   3               ES=1;
  61   3            }
  62   2          }
  63   1      }
  64          
  65          //替换标准库函数putchar程序
  66          //printf函数使用putchar输出一个字符
  67          char putchar (char c)
  68          { 
  69   1        if (c=='\n')
  70   1          {
  71   2            while(sendfull);
  72   2            putbuf(0x0D);
  73   2          }
  74   1        while(sendfull);
  75   1        putbuf(c);
  76   1        return(c);
  77   1      }
  78          
  79          //替换标准库函数_getkey程序
  80          //getchar和gets函数使用_getkey
  81          char _getkey(void)
  82          { 
  83   1        char c;
  84   1        while(iend==istart)
  85   1        {;}
  86   1        ES=0;
  87   1        c=inbuf[istart++&(ILEN-1)];
  88   1        ES=1;
  89   1        return(c);
  90   1      }
  91          
  92          /* 初始化串行口和UART波特率函数*/
  93          void com_initialize(void)
  94          { 
  95   1        istart=0;
  96   1        iend=0;
  97   1        ostart=0;
  98   1        oend=0;
  99   1        sendactive=0;
 100   1        sendfull=0;
 101   1      
 102   1        TMOD |=0x20;   //T/C1工作在方式2
 103   1        TH1=0xfd;
 104   1        TR1=1;         
 105   1        SCON=0xd8;
 106   1        ES=1;
 107   1      }    
 108          
 109          void uart_Init()
 110          { 
 111   1        com_initialize();
 112   1        EA=1;
 113   1      }
 114          


C51 COMPILER V9.54   UART                                                                  10/21/2025 15:22:00 PAGE 3   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    193    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =     16    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
