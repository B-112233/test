C51 COMPILER V9.54   TCS230                                                                10/22/2025 20:45:26 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE TCS230
OBJECT MODULE PLACED IN .\Objects\tcs230.obj
COMPILER INVOKED BY: D:\Keil5\C51\BIN\C51.EXE Hardware\tcs230.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\System;.\src;.\Hardwar
                    -e) DEBUG OBJECTEXTEND PRINT(.\Listings\tcs230.lst) OBJECT(.\Objects\tcs230.obj)

line level    source

   1          /************************************************
   2          �ļ� : tcs230.c
   3          ���� ��TCS320��ɫʶ��
   4          ��д : ����
   5          Ŀ��MCU��AT89S52
   6          ����11.0592MHZ
   7          ************************************************/
   8          #include "uart2.h"
   9          #include "tcs230.h"
  10          #define LED P1_3 
  11              
  12          sbit  s0   =   P2^1;     
  13          sbit  s1   =   P2^2;     
  14          sbit  s2   =   P2^3;    
  15          sbit  s3   =   P2^4;
  16             
  17          
  18          long int  green=0,red=0,blue=0; //RGB��ɫ��ʼ��
  19          
  20          /**********************RGB����ϵ��***************************/
  21          /****************ͨ����ƽ��ó���ʱ�����ϵ��*************/
  22          #define pred   76
  23          #define pgreen 73
  24          #define pblue  72
  25          
  26          int  disp_tc;  //������־
  27          
  28          
  29          
  30          
  31          
  32          /***************************led���� ��˸3��****************************/
  33          void test_led()
  34          {
  35   1              uchar i;
  36   1              for(i=0;i<3;i++)
  37   1              {
  38   2                      LED=0;
  39   2                      delay_nms(200);
  40   2                      LED=1;
  41   2                      delay_nms(200);
  42   2              }
  43   1              LED=0;
  44   1      }
  45          /***************************��������ʼ��****************************/
  46          void t0_init()
  47          {  
  48   1              TMOD=0x51;//���ö�ʱ��0Ϊ������ʽһ
  49   1      
  50   1              TH0 =0xfc;
  51   1              TL0 =0x66;//���������11.0592MHZ�Ļ��������0.00017%
  52   1                      
  53   1              EA=1;
  54   1              ET0=1;
C51 COMPILER V9.54   TCS230                                                                10/22/2025 20:45:26 PAGE 2   

  55   1              TR0=1;
  56   1              TR1=1;
  57   1      }
  58          
  59          /************************10ms�ж��ӳ��� *******************/
  60          void c1ms_out() interrupt 1//��ʱ��0 1ms�ж���Ӧ
  61          {       
  62   1              TR0=0;
  63   1              TR1=0;
  64   1              
  65   1                      disp_tc=disp_tc+1; //����ֵ��һ
  66   1                      TH0=0xfc;
  67   1                  TL0=0x66+TL0;     //�Ӷ�ʱ������
  68   1                                                      
  69   1                  TR0=1;
  70   1                  TR1=1;
  71   1              
  72   1      }   
  73          
  74          /*****************************�����Ƴ���****************************/
  75          int get_color(void)
  76          {
  77   1              unsigned char i = 2;
  78   1              int color;
  79   1              test_led();                     //����led
  80   1              delay_nms(80);          //��ʱ �ȴ����ڵ��Թ���
  81   1              LED=1;                          //��led
  82   1      
  83   1      
  84   1              s0=1; s1=1;
  85   1              t0_init();
  86   1              Time2_init(); 
  87   1              while(i--)
  88   1              {                               //ѡ����ɫ�˹�
  89   2                      disp_tc=0;
  90   2                      s2=0;
  91   2                      s3=1;
  92   2                      while(disp_tc!=pblue);
  93   2                      TR0=0;
  94   2                      TR1=0;
  95   2                      blue=TH1*256+TL1;
  96   2                      TL1=0x00;
  97   2                      TH1=0x00;
  98   2                      disp_tc=0;
  99   2                      TR0=1;
 100   2                      TR1=1;
 101   2      
 102   2                      //ѡ����ɫ�˹�
 103   2                      s2=1;
 104   2                      s3=1;
 105   2                      while(disp_tc!=pgreen);
 106   2                      TR0=0;
 107   2                      TR1=0;
 108   2                      green=TH1*256+TL1;
 109   2                      TL1=0x00;
 110   2                      TH1=0x00;
 111   2                      disp_tc=0;
 112   2                      TR0=1;
 113   2                      TR1=1;
 114   2      
 115   2                      //ѡ���ɫ�˹�
 116   2                      s2=0;
C51 COMPILER V9.54   TCS230                                                                10/22/2025 20:45:26 PAGE 3   

 117   2                      s3=0;
 118   2                      while(disp_tc!=pred); 
 119   2                      TR0=0;
 120   2                      TR1=0;
 121   2                      red=TH1*256+TL1;
 122   2                      TL1=0x00;
 123   2                      TH1=0x00;
 124   2                      disp_tc=0;
 125   2                      //�رն�ʱ��������ֻΪ��ʾ��
 126   2                      printf("red=%ld,green=%ld,blue=%ld\n",red,green,blue);
 127   2                      delay_nms(200);
 128   2                      TR0=1;
 129   2                      TR1=1;  
 130   2              }
 131   1      
 132   1              printf("red=%ld,green=%ld,blue=%ld\n", red, green, blue);
 133   1              if(red <= 35 && green <= 35 && blue <= 35){
 134   2                      color = BLACK;
 135   2              }
 136   1              else if (red >= 200 && green >= 200 && blue >= 200){
 137   2                      color = WHITE;
 138   2              }
 139   1              else if (red >= 150 && green <= 50 && blue <= 50){
 140   2                      color = RED;
 141   2              }
 142   1              else if (red >= 200 && green >= 150 && blue <= 100){
 143   2                      color = YELLOW;
 144   2              }
 145   1              else if(blue > 40 && blue < 190)
 146   1              {
 147   2                      color = BLUE;
 148   2                      printf("color = %d\n", color);
 149   2              }
 150   1              EA = 0;
 151   1              ET0 = 0;
 152   1              TR0 = 0;
 153   1              TR1 = 0;
 154   1              return color;
 155   1      }
 156          
 157          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    741    ----
   CONSTANT SIZE    =     40    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
