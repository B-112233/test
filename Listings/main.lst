C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil5\C51\BIN\C51.EXE src\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\System;.\src;.\Hardware) DEBU
                    -G OBJECTEXTEND PRINT(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <AT89X52.H>     
   2          #include <Boebot.h>
   3          #include "motor.h"
   4          #include "uart.h"
   5          #include "ultrasonic.h"
   6          #include "tcs230.h"
   7          
   8          void tracking(void);
   9          void put_color(void);
  10          
  11          int qtis, qtis_color, step = 0, color, turn_r_i = 0;
  12          unsigned char flag = 0, flag_color = 1, flag_put_color = 0,
  13                                    flag_back = 1, flag_dis = 1, 
  14                                    flag_black = 0, flag_obj = 0, flag_obj_t = 0,
  15                                    flag_test_color = 0, flag_turn_r = 0,
  16                                    flag_right = 0, flag_left = 0,
  17                                    flag_black_white_take = 1, flag_take_back = 0, flag_con = 0,
  18                                    flag_bw_back = 0, flag_bw_color = 0, flag_track = 1, flag_interval = 0,
  19                                    flag_interval_step = 0, flag_put = 0, flag_turn = 0, flag_dis_low = 0, flag_stage = 0;
  20                                    
  21          unsigned char obj_count = 0, put_obj_count = 0, take_obj_count = 0;
  22          
  23          void main(void)
  24          {
  25   1              unsigned char record = 0, j = 0, black_white_count = 0;
  26   1              int i, turn_r_count = 0;
  27   1              char ii = 0;
  28   1              unsigned int dis;
  29   1              uart_Init();    //初始化超声波
  30   1      
  31   1              //开始时向前走一段
  32   1              delay_nms(2000);
  33   1              Fast_forward(40);
  34   1      
  35   1              /*第一阶段 把物块搬回缓冲区或搬到指定位置*/
  36   1              while(1)
  37   1              {
  38   2                      if(flag_track == 1)
  39   2                      {
  40   3                              tracking();
  41   3                      }
  42   2      
  43   2                      if(flag_interval_step == 0)
  44   2                      {
  45   3                              if(qtis == 15 && flag_turn == 0)                                          
  46   3                              {
  47   4                                      step = 0;
  48   4                                      record++;
  49   4                                      switch(record)                          
  50   4                                      {
  51   5                                              case 1:Fast_forward(12);turn_left_90();break;
  52   5                                              case 2:Fast_forward(12);turn_right_90();break;
  53   5                                              case 3:Fast_forward(12);turn_left_45();break;
  54   5                                              case 4:Fast_forward(15);turn_right_45();break;  
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 2   

  55   5                                              case 5:Fast_forward(15);break;
  56   5                                              case 6:Fast_forward(15);break;
  57   5                                              case 7:Fast_forward(15);turn_right_45();break;             
  58   5                                              case 8:Fast_forward(15);turn_left_45();break;
  59   5                                              case 9:Fast_forward(10);turn_right_90();break;           
  60   5                                              case 10:Fast_forward(12);turn_left_90();break;
  61   5                                      }
  62   4                                      
  63   4                                      if (record % 2 == 1 && record > 0)
  64   4                                      {
  65   5                                              flag_dis = 1;
  66   5                                      }
  67   4                                      else
  68   4                                      {
  69   5                                              flag_interval = 1;
  70   5                                              flag_interval_step = 1;
  71   5                                              flag = 0;
  72   5                                              flag_dis = 0;
  73   5                                      }
  74   4                                      ii=0;
  75   4                              }
  76   3                      }
  77   2      
  78   2                      if (flag_dis == 1)
  79   2                      {
  80   3                              InitTimer(); // 给超声波计时
  81   3                              dis = GetSonarDis();
  82   3                      }
  83   2      
  84   2                      if (dis < 5 && flag_dis == 1)
  85   2                      {
  86   3                              take_obj_count++;
  87   3                              Fast_forward(12);
  88   3                              stop();
  89   3                              if(take_obj_count == 3)
  90   3                              {
  91   4                                      record++;
  92   4                                      flag_turn = 2;
  93   4                              }
  94   3                              color = get_color();
  95   3                              Fast_forward(50);
  96   3                              flag_test_color = 1;
  97   3                              flag_dis = 0;
  98   3                              flag_obj = 1;
  99   3                      }
 100   2      
 101   2                      /* 放黄、红、蓝物块 */
 102   2                      if (flag_test_color)
 103   2                      {
 104   3                              if ((color == YELLOW && record == 1) ||
 105   3                                      (color == WHITE && record == 3) ||
 106   3                                      (color == RED && record == 5) ||
 107   3                                      (color == BLACK && record == 7) ||
 108   3                                      (color == BLUE && record == 9))
 109   3                              {
 110   4                                      flag_put_color = 1;
 111   4                                      flag_turn = 1;
 112   4      
 113   4                                      if(color == WHITE || color == RED || color == BLACK)
 114   4                                      {
 115   5                                              if ((qtis_color == 48 || qtis_color == 16 || qtis_color == 32) && color != 0 && flag_put_color == 1)
 116   5                                              {
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 3   

 117   6                                                      flag_track = 0;
 118   6                                                      Fast_forward(6);
 119   6                                                      stop();
 120   6                                                      back(30);
 121   6                                                      turn_back();
 122   6                                                      flag_track = 1;
 123   6                                                      obj_count++;
 124   6                                                      flag_put_color = 0;
 125   6                                                      flag_test_color = 0;
 126   6                                                      color = 0;
 127   6                                                      record++;
 128   6                                                      ii = 0;
 129   6                                              }
 130   5                                      }
 131   4                                      if(color == YELLOW)
 132   4                                      {
 133   5                                              if (qtis_color == 32 && color != 0 && flag_put_color == 1)
 134   5                                              {
 135   6                                                      flag_track = 0;
 136   6                                                      Fast_forward(20);
 137   6                                                      for(turn_r_i = 0; turn_r_i < 3; turn_r_i++)
 138   6                                                      {
 139   7                                                      turn_r(1510, 1510);
 140   7                                                      }
 141   6                                                      stop();
 142   6                                                      back(30);
 143   6                                                      turn_back();
 144   6                                                      flag_track = 1;
 145   6                                                      obj_count++;
 146   6                                                      flag_put_color = 0;
 147   6                                                      flag_test_color = 0;
 148   6                                                      color = 0;
 149   6                                                      record++;
 150   6                                              }
 151   5      
 152   5                                              /*防止冲出地图*/
 153   5                                              if (qtis_color == 16 && qtis == 0 && color != 0 && flag_put_color == 1)
 154   5                                              {
 155   6                                                      flag_track = 0;
 156   6                                                      for (turn_r_i = 0; turn_r_i < 3; turn_r_i++)
 157   6                                                      {
 158   7                                                              turn_r(1510, 1510);
 159   7                                                      }
 160   6                                                      stop();
 161   6                                                      back(30);
 162   6                                                      turn_back();
 163   6                                                      flag_track = 1;
 164   6                                                      obj_count++;
 165   6                                                      flag_put_color = 0;
 166   6                                                      flag_test_color = 0;
 167   6                                                      color = 0;
 168   6                                                      record++;
 169   6                                              }
 170   5                                      }
 171   4      
 172   4                                      if(color == BLUE)
 173   4                                      {
 174   5                                              if (qtis_color == 16 && color != 0 && flag_put_color == 1)
 175   5                                              {
 176   6                                                      
 177   6                                                      flag_track = 0;
 178   6                                                      Fast_forward(18);
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 4   

 179   6                                                      stop();
 180   6                                                      back(30);
 181   6                                                      turn_back();
 182   6                                                      flag_track = 1;
 183   6                                                      obj_count++;
 184   6                                                      flag_put_color = 0;
 185   6                                                      flag_test_color = 0;
 186   6                                                      color = 0;
 187   6                                                      record++;
 188   6                                              }
 189   5                                              /*防止冲出地图*/
 190   5                                              if (qtis_color == 32 && qtis == 0 && color != 0 && flag_put_color == 1)
 191   5                                              {
 192   6      
 193   6                                                      flag_track = 0;
 194   6                                                      stop();
 195   6                                                      back(30);
 196   6                                                      turn_back();
 197   6                                                      flag_track = 1;
 198   6                                                      obj_count++;
 199   6                                                      flag_put_color = 0;
 200   6                                                      flag_test_color = 0;
 201   6                                                      color = 0;
 202   6                                                      record++;
 203   6                                              }
 204   5                                      }
 205   4                                      
 206   4                                      /* 4 qtis */
 207   4                                      // if (qtis == 0)
 208   4                                      //      ii++;
 209   4                                      // if (ii > 2 && qtis == 0 && color != 0)
 210   4                                      // {
 211   4                                      //      back(30);
 212   4                                      //      turn_back();
 213   4                                      //      obj_count++;
 214   4                                      //      flag_test_color = 0;
 215   4                                      //      color = 0;
 216   4                                      //      ii = 0;
 217   4                                      // }
 218   4                              }
 219   3                              else
 220   3                              {
 221   4                                      Fast_forward(20);
 222   4                                      turn_back();
 223   4                                      flag_test_color = 0;
 224   4                              }
 225   3                      }
 226   2                      
 227   2                      if (record % 2 == 1 && flag_obj == 0)
 228   2                      {
 229   3                              if (qtis == 0)
 230   3                                      ii++;
 231   3                              if (ii > 2 && (qtis == 0 || qtis == 10 || qtis == 5 || qtis == 9 || qtis == 11 || qtis == 13))
 232   3                              {
 233   4                                      flag_turn = 1;
 234   4                                      Fast_forward(65);
 235   4                                      turn_back();
 236   4                                      record++;
 237   4                                      ii = 0;
 238   4                              }
 239   3                      }
 240   2      
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 5   

 241   2                      /*把物体间隔放到缓冲区*/
 242   2                      if(record % 2 == 0 && record > 0 && flag_obj == 1 && flag_interval == 1)
 243   2                      {
 244   3                              if(step > (175 - j * 45)) 
 245   3                              {
 246   4                                      back(30);
 247   4                                      turn_back();
 248   4                                      flag_obj = 0;
 249   4                                      flag = 1;
 250   4                                      step = 0;
 251   4                                      flag_interval = 0;
 252   4                                      j++;
 253   4                              }
 254   3                              flag_dis = 0;
 255   3                      }
 256   2                      else if(record % 2 == 0 && record > 0 && flag_turn == 1)
 257   2                      {
 258   3                              if(qtis == 15)
 259   3                              {
 260   4                                      step = 0;
 261   4                                      flag_obj = 0;
 262   4                                      switch(record)                          
 263   4                                      {
 264   5                                              case 2:Fast_forward(18);turn_left_90();turn_left_45();break;
 265   5                                              case 4:Fast_forward(18);turn_left_45();turn_left_90();break;    
 266   5                                              case 6:Fast_forward(18);turn_back();turn_right_45();break;
 267   5                                              case 8:Fast_forward(18);turn_left_45();turn_left_90();break;
 268   5                                              case 10:Fast_forward(18);turn_left_90();break;
 269   5                                      }
 270   4                                      record++;
 271   4                                      if (record % 2 == 1 && record > 0)
 272   4                                      {
 273   5                                              flag_dis = 1;
 274   5                                      }
 275   4                                      else
 276   4                                      {
 277   5                                              flag_interval_step = 1;
 278   5                                              flag = 0;
 279   5                                              flag_dis = 0;
 280   5                                      }
 281   4                                      ii = 0;
 282   4                                      flag_turn = 0;
 283   4                              }
 284   3                              // if(step > 120)
 285   3                              // {
 286   3                              //      step = 0;
 287   3                              //      turn_back();
 288   3                              //      flag_interval_step = 0;
 289   3                              //      flag_obj = 0;
 290   3                              //      flag = 1;
 291   3                              //      flag_dis = 0;
 292   3                              // }
 293   3                      }
 294   2      
 295   2                      if (step > 80 && flag == 1 && flag_obj == 0)
 296   2                      {
 297   3                              step = 0;
 298   3                              flag_interval_step = 0;
 299   3                      }
 300   2      
 301   2                      if(take_obj_count == 3)
 302   2                      {
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 6   

 303   3                              flag_stage = 3;
 304   3                              if(qtis == 15 && flag_turn == 2)
 305   3                              {
 306   4                                      step = 0;
 307   4                                      switch(record)                          
 308   4                                      {
 309   5                                              case 2:Fast_forward(12);turn_left_90();break;
 310   5                                              case 4:Fast_forward(15);turn_left_90();turn_left_45();break;    
 311   5                                              case 6:Fast_forward(15);turn_back();break;
 312   5                                              case 8:Fast_forward(15);turn_right_45();turn_right_90();break;
 313   5                                              case 10:Fast_forward(12);turn_right_90();break;
 314   5                                      }
 315   4                                      break;
 316   4                              }
 317   3                      }
 318   2              }
 319   1      
 320   1              /* 第二部分 前置*/
 321   1              flag_back = 0;
 322   1              if(take_obj_count == 3)
 323   1              {
 324   2                      while (1)
 325   2                      {
 326   3                              if(flag_track == 1)
 327   3                              {
 328   4                                      tracking();
 329   4                              }
 330   3      
 331   3                              if(take_obj_count == 3 && color != 0)
 332   3                              {
 333   4                                      step = 0;
 334   4                                      take_obj_count = 0;
 335   4                                      flag_put_color = 1;
 336   4                                      switch (color)
 337   4                                      {
 338   5                                              case YELLOW:turn_left_90();break;
 339   5                                              case WHITE:turn_left_45();break;
 340   5                                              case RED:Fast_forward(10);break;
 341   5                                              case BLACK:turn_right_45();break;
 342   5                                              case BLUE:turn_right_90();break;
 343   5                                      }
 344   4                              }
 345   3      
 346   3                              if (step >= 30)
 347   3                              {
 348   4                                      if (color == WHITE || color == RED || color == BLACK)
 349   4                                      {
 350   5                                              if ((qtis_color == 48 || qtis_color == 16 || qtis_color == 32) && color != 0 && flag_put_color == 1)
 351   5                                              {
 352   6                                                      flag_track = 0;
 353   6                                                      Fast_forward(6);
 354   6                                                      stop();
 355   6                                                      back(30);
 356   6                                                      turn_back();
 357   6                                                      flag_track = 1;
 358   6                                                      obj_count++;
 359   6                                                      step = 0;
 360   6                                                      flag_obj = 0;
 361   6                                                      flag_back = 1;
 362   6                                                      flag_put_color = 0;
 363   6                                              }
 364   5                                      }
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 7   

 365   4      
 366   4                                      if (color == YELLOW)
 367   4                                      {
 368   5                                              if (qtis_color == 32 && color != 0 && flag_put_color == 1)
 369   5                                              {
 370   6                                                      flag_track = 0;
 371   6                                                      Fast_forward(20);
 372   6                                                      for (turn_r_i = 0; turn_r_i < 3; turn_r_i++)
 373   6                                                      {
 374   7                                                              turn_r(1510, 1510);
 375   7                                                      }
 376   6                                                      stop();
 377   6                                                      back(30);
 378   6                                                      turn_back();
 379   6                                                      flag_track = 1;
 380   6                                                      obj_count++;
 381   6                                                      step = 0;
 382   6                                                      flag_obj = 0;
 383   6                                                      flag_back = 1;
 384   6                                                      flag_put_color = 0;
 385   6                                              }
 386   5      
 387   5                                              /*防止冲出地图*/
 388   5                                              if (qtis_color == 16 && qtis == 0 && color != 0 && flag_put_color == 1)
 389   5                                              {
 390   6                                                      flag_track = 0;
 391   6                                                      for (turn_r_i = 0; turn_r_i < 3; turn_r_i++)
 392   6                                                      {
 393   7                                                              turn_r(1510, 1510);
 394   7                                                      }
 395   6                                                      stop();
 396   6                                                      back(30);
 397   6                                                      turn_back();
 398   6                                                      flag_track = 1;
 399   6                                                      obj_count++;
 400   6                                                      step = 0;
 401   6                                                      flag_obj = 0;
 402   6                                                      flag_back = 1;
 403   6                                                      flag_put_color = 0;
 404   6                                              }
 405   5                                      }
 406   4      
 407   4                                      if (color == BLUE)
 408   4                                      {
 409   5                                              if (qtis_color == 16 && color != 0 && flag_put_color == 1)
 410   5                                              {
 411   6      
 412   6                                                      flag_track = 0;
 413   6                                                      Fast_forward(18);
 414   6                                                      stop();
 415   6                                                      back(30);
 416   6                                                      turn_back();
 417   6                                                      flag_track = 1;
 418   6                                                      obj_count++;
 419   6                                                      step = 0;
 420   6                                                      flag_obj = 0;
 421   6                                                      flag_back = 1;
 422   6                                                      flag_put_color = 0;
 423   6                                              }
 424   5                                              /*防止冲出地图*/
 425   5                                              if (qtis_color == 32 && qtis == 0 && color != 0 && flag_put_color == 1)
 426   5                                              {
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 8   

 427   6      
 428   6                                                      flag_track = 0;
 429   6                                                      stop();
 430   6                                                      back(30);
 431   6                                                      turn_back();
 432   6                                                      flag_track = 1;
 433   6                                                      obj_count++;
 434   6                                                      step = 0;
 435   6                                                      flag_obj = 0;
 436   6                                                      flag_back = 1;
 437   6                                                      flag_put_color = 0;
 438   6                                                      flag_test_color = 0;
 439   6                                              }
 440   5                                      }
 441   4                              }
 442   3      
 443   3                              if (qtis == 15 && flag_back == 1)
 444   3                              {
 445   4                                      step = 0;
 446   4                                      switch (color)
 447   4                                      {
 448   5                                              case YELLOW:Fast_forward(12);turn_right_90();break;
 449   5                                              case WHITE:Fast_forward(20);turn_right_45();break;
 450   5                                              case RED:Fast_forward(15);break;
 451   5                                              case BLACK:Fast_forward(18);turn_left_45();break;
 452   5                                              case BLUE:Fast_forward(12);turn_left_90();break;
 453   5                                      }
 454   4                                      color = 0;
 455   4                                      break;
 456   4                              }
 457   3                      }
 458   2              }
 459   1              
 460   1      
 461   1              /* 第二部分 判断颜色 搬到指定地点*/
 462   1              // flag_dis = 1;        // 测距离标志位
 463   1              // flag_black = 0; // 黑色物块标志位
 464   1              // flag_color = 1; // 颜色检查标志位
 465   1              // flag_obj = 0;        // 是否有物块
 466   1              // flag_put_color = 0;          //放置物块标志位
 467   1              // flag_track = 1;              //循迹标志位
 468   1              // flag_interval_step = 1;
 469   1              // ii = 0;
 470   1              // if(obj_count != 3)
 471   1              // {
 472   1              //      while(1)
 473   1              //      {
 474   1              //              // 循迹
 475   1              //              if(flag_track == 1)
 476   1              //              {
 477   1              //                      tracking();
 478   1              //              }
 479   1      
 480   1              //              if (flag_dis == 1)
 481   1              //              {
 482   1              //                      InitTimer(); // 给超声波计时
 483   1              //                      dis = GetSonarDis();
 484   1              //                      if (dis > 6 && dis < 20)
 485   1              //                      {
 486   1              //                              flag_obj = 1;
 487   1              //                      }
 488   1              //              }
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 9   

 489   1      
 490   1              //              // if (dis > 95 && flag_obj == 1)
 491   1              //              // {
 492   1              //              //      dis = 0;
 493   1              //              // }
 494   1      
 495   1              //              // dis <= 2时判断颜色，获取颜色
 496   1              //              if(dis < 4 && flag_color == 1 && flag_obj == 1)
 497   1              //              {
 498   1              //                      Fast_forward(10);
 499   1              //                      stop();
 500   1              //                      color = get_color();
 501   1              //                      if(take_obj_count != 3)
 502   1              //                      {
 503   1              //                              turn_back();
 504   1              //                      }
 505   1              //                      Fast_forward(20);
 506   1              //                      flag_obj = 0;
 507   1              //                      flag_color = 0;
 508   1              //                      flag_back = 0;
 509   1              //                      flag_dis = 0;
 510   1              //                      flag_interval_step = 1;
 511   1              //              }
 512   1      
 513   1              //              if (step > 10 && flag_interval_step == 1)
 514   1              //              {
 515   1              //                      step = 0;
 516   1              //                      flag_interval_step = 0;
 517   1              //              }
 518   1      
 519   1              //              if(flag_interval_step == 0)
 520   1              //              {
 521   1              //                      if (qtis == 15 && flag_back == 0)
 522   1              //                      {
 523   1              //                              step = 0;
 524   1              //                              ii = 0;
 525   1              //                              switch (color)
 526   1              //                              {
 527   1              //                                      case YELLOW:Fast_forward(12);turn_left_90();break;
 528   1              //                                      case WHITE:Fast_forward(15);turn_left_45();break;
 529   1              //                                      case RED:Fast_forward(15);break;
 530   1              //                                      case BLACK:Fast_forward(15);turn_right_45();break;
 531   1              //                                      case BLUE:Fast_forward(15);turn_right_90();break;
 532   1              //                              }
 533   1              //                              flag_put_color = 1;
 534   1              //                      }
 535   1              //              }
 536   1                              
 537   1              //              //放到对应位置，flag_back置1
 538   1              //              // if(flag_black == 1)
 539   1              //              // {
 540   1              //              //      if (step >= 55)
 541   1              //              //      {
 542   1              //              //              back(30);
 543   1              //              //              turn_back();
 544   1              //              //              step = 0;
 545   1              //              //              flag_back = 1;
 546   1              //              //              flag_black = 0;
 547   1              //              //      }
 548   1              //              // }
 549   1                              
 550   1      
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 10  

 551   1              //              if(step > 30)
 552   1              //              {
 553   1              //                      if (color == WHITE || color == RED || color == BLACK)
 554   1              //                      {
 555   1              //                              if ((qtis_color == 48 || qtis_color == 16 || qtis_color == 32) && color != 0 && flag_put_color == 
             -1)
 556   1              //                              {
 557   1              //                                      flag_track = 0;
 558   1              //                                      Fast_forward(5);
 559   1              //                                      stop();
 560   1              //                                      back(30);
 561   1              //                                      turn_back();
 562   1              //                                      flag_track = 1;
 563   1              //                                      obj_count++;
 564   1              //                                      step = 0;
 565   1              //                                      flag_obj = 0;
 566   1              //                                      flag_back = 1;
 567   1              //                                      flag_put_color = 0;
 568   1              //                              }
 569   1              //                      }
 570   1      
 571   1              //                      if (color == YELLOW)
 572   1              //                      {
 573   1              //                              if (qtis_color == 32 && color != 0 && flag_put_color == 1)
 574   1              //                              {
 575   1              //                                      flag_track = 0;
 576   1              //                                      Fast_forward(20);
 577   1              //                                      for (turn_r_i = 0; turn_r_i < 3; turn_r_i++)
 578   1              //                                      {
 579   1              //                                              turn_r(1510, 1510);
 580   1              //                                      }
 581   1              //                                      stop();
 582   1              //                                      back(30);
 583   1              //                                      turn_back();
 584   1              //                                      flag_track = 1;
 585   1              //                                      obj_count++;
 586   1              //                                      step = 0;
 587   1              //                                      flag_obj = 0;
 588   1              //                                      flag_back = 1;
 589   1              //                                      flag_put_color = 0;
 590   1              //                              }
 591   1      
 592   1              //                              /*防止冲出地图*/
 593   1              //                              if (qtis_color == 16 && qtis == 0 && color != 0 && flag_put_color == 1)
 594   1              //                              {
 595   1              //                                      flag_track = 0;
 596   1              //                                      for (turn_r_i = 0; turn_r_i < 3; turn_r_i++)
 597   1              //                                      {
 598   1              //                                              turn_r(1510, 1510);
 599   1              //                                      }
 600   1              //                                      stop();
 601   1              //                                      back(30);
 602   1              //                                      turn_back();
 603   1              //                                      flag_track = 1;
 604   1              //                                      obj_count++;
 605   1              //                                      step = 0;
 606   1              //                                      flag_obj = 0;
 607   1              //                                      flag_back = 1;
 608   1              //                                      flag_put_color = 0;
 609   1              //                              }
 610   1              //                      }
 611   1      
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 11  

 612   1              //                      if (color == BLUE)
 613   1              //                      {
 614   1              //                              if (qtis_color == 16 && color != 0 && flag_put_color == 1)
 615   1              //                              {
 616   1      
 617   1              //                                      flag_track = 0;
 618   1              //                                      Fast_forward(18);
 619   1              //                                      stop();
 620   1              //                                      back(30);
 621   1              //                                      turn_back();
 622   1              //                                      flag_track = 1;
 623   1              //                                      obj_count++;
 624   1              //                                      step = 0;
 625   1              //                                      flag_obj = 0;
 626   1              //                                      flag_back = 1;
 627   1              //                                      flag_put_color = 0;
 628   1              //                              }
 629   1              //                              /*防止冲出地图*/
 630   1              //                              if (qtis_color == 32 && qtis == 0 && color != 0 && flag_put_color == 1)
 631   1              //                              {
 632   1      
 633   1              //                                      flag_track = 0;
 634   1              //                                      stop();
 635   1              //                                      back(30);
 636   1              //                                      turn_back();
 637   1              //                                      flag_track = 1;
 638   1              //                                      obj_count++;
 639   1              //                                      step = 0;
 640   1              //                                      flag_obj = 0;
 641   1              //                                      flag_back = 1;
 642   1              //                                      flag_put_color = 0;
 643   1              //                                      flag_test_color = 0;
 644   1              //                              }
 645   1              //                      }
 646   1              //              }
 647   1                              
 648   1              //              if(flag_interval_step == 0)
 649   1              //              {
 650   1              //                      if (qtis == 15 && flag_back == 1)
 651   1              //                      {
 652   1              //                              flag_dis = 1;
 653   1              //                              flag_color = 1;
 654   1              //                              step = 0;
 655   1              //                              switch (color)
 656   1              //                              {
 657   1              //                                      case YELLOW:Fast_forward(12);turn_right_90();break;
 658   1              //                                      case WHITE:Fast_forward(20);turn_right_45();break;
 659   1              //                                      case RED:Fast_forward(15);break;
 660   1              //                                      case BLACK:Fast_forward(18);turn_left_45();break;
 661   1              //                                      case BLUE:Fast_forward(12);turn_left_90();break;
 662   1              //                              }
 663   1      
 664   1              //                              color = 0;
 665   1              //                              if (obj_count == 3) // 搬完三个回来，准备搬运黑白
 666   1              //                              {
 667   1              //                                      turn_back();
 668   1              //                                      break;
 669   1              //                              }
 670   1              //                      }
 671   1              //              }
 672   1              //      }
 673   1              // }
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 12  

 674   1              
 675   1      
 676   1              /*第三阶段 搬运黑白物块*/
 677   1              // flag_dis = 0;        // 测距离标志位
 678   1              // flag_black = 0; // 黑色物块标志位
 679   1              // flag_color = 0; // 颜色检查标志位
 680   1              // flag_obj = 0;        // 是否有物块
 681   1              // flag_black_white_take = 1;   //标志取到黑白物块
 682   1              // flag_back = 0;               //返回标志位
 683   1              // flag_track = 1;
 684   1              // obj_count = 0;
 685   1              // color = 0;
 686   1              // dis = 100;
 687   1              // ii = 0;
 688   1              // step = 0;
 689   1              // if(flag_stage = 3)
 690   1              // {
 691   1              //      turn_back();
 692   1              // }
 693   1              // while(1)
 694   1              // {
 695   1              //      // 循迹
 696   1              //      if(flag_track == 1)
 697   1              //      {
 698   1              //              tracking();
 699   1              //      }
 700   1      
 701   1              //      if(qtis == 15 && flag_black_white_take == 1)
 702   1              //      {
 703   1              //              Fast_forward(12);
 704   1              //              turn_right_90();
 705   1              //              flag_turn_r = 1;
 706   1              //      }
 707   1                      
 708   1              //      if(flag_turn_r == 1)
 709   1              //      {
 710   1              //              turn_r_count = 0;
 711   1              //              for(i=0; i < 200; i++)               //利用超声波搜索第五个物块500
 712   1              //              {                       
 713   1              //                      InitTimer();  //定时器初始化
 714   1              //                      dis = GetSonarDis(); //启动超声波
 715   1              //                      //printf("m = : %d\n",m);
 716   1              //                      //delay_nms(100);
 717   1              //                      turn_r(1530,1530); //微转动
 718   1                                      
 719   1              //                      if(dis >= 10 && dis < 20)
 720   1              //                      {
 721   1              //                              turn_r_count = i;
 722   1              //                              if(black_white_count > 5)  //有几次次检测到物块，则前进80步，取下物块。
 723   1              //                              {
 724   1              //                                      stop();
 725   1              //                                      Fast_forward(98);
 726   1              //                                      flag_black_white_take = 0;
 727   1              //                                      flag_bw_back = 1;
 728   1              //                                      break;
 729   1              //                              }
 730   1              //                              black_white_count++;
 731   1              //                      }
 732   1              //              }
 733   1              //              flag_turn_r = 0;
 734   1              //      }
 735   1              //      if (turn_r_count > 40)
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 13  

 736   1              //      {
 737   1              //              flag_left = 1;
 738   1              //              flag_right = 0;
 739   1              //      }
 740   1              //      else
 741   1              //      {
 742   1              //              flag_right = 1;
 743   1              //              flag_left = 0;
 744   1              //      }
 745   1      
 746   1              //      if(qtis == 15 && flag_bw_back == 1)
 747   1              //      {
 748   1              //              step = 0;
 749   1              //              flag_bw_color = 1;
 750   1              //              if (flag_right == 1)
 751   1              //              {
 752   1              //                      Fast_forward(12);
 753   1              //                      turn_right_90();
 754   1              //              }
 755   1              //              else if (flag_left == 1)
 756   1              //              {
 757   1              //                      Fast_forward(12);
 758   1              //                      turn_left_90();
 759   1              //              }
 760   1              //              flag_bw_back = 0;
 761   1              //      }
 762   1      
 763   1              //      if (qtis == 15 && flag_bw_color == 1 && step > 10)
 764   1              //      {
 765   1              //              step = 0;
 766   1              //              if (flag_right == 1)
 767   1              //              {
 768   1              //                      Fast_forward(20);
 769   1              //                      turn_right_120();
 770   1              //                      Fast_forward(40);
 771   1              //                      stop();
 772   1              //                      back(30);
 773   1              //                      flag_con = 1;
 774   1              //                      flag_dis = 1;
 775   1              //                      flag_color = 1;
 776   1              //              }
 777   1              //              else if (flag_left == 1)
 778   1              //              {
 779   1              //                      Fast_forward(20);
 780   1              //                      turn_left_120();
 781   1              //                      Fast_forward(40);
 782   1              //                      stop();
 783   1              //                      back(30);
 784   1              //                      flag_con = 1;
 785   1              //                      flag_dis = 1;
 786   1              //                      flag_color = 1;
 787   1              //              }
 788   1              //              flag_bw_color = 0;
 789   1              //      }
 790   1              //      if (flag_dis == 1 && flag_bw_color == 0)
 791   1              //      {
 792   1              //              InitTimer(); // 给超声波计时
 793   1              //              dis = GetSonarDis();
 794   1              //              if (dis > 5 && dis < 20)
 795   1              //              {
 796   1              //                      flag_obj = 1;
 797   1              //              }
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 14  

 798   1              //      }
 799   1      
 800   1              //      //判断颜色，获取颜色
 801   1              //      if(dis < 5  && flag_color == 1 && flag_dis == 1 && flag_con == 1)
 802   1              //      {
 803   1              //              Fast_forward(10);
 804   1              //              stop();
 805   1              //              color = get_color();
 806   1              //              if(color == BLACK)
 807   1              //              {
 808   1              //                      flag_black = 1;
 809   1              //              }
 810   1              //              flag_con = 0;
 811   1              //              flag_obj = 1;
 812   1              //              flag_color = 0;
 813   1              //              flag_back = 0;
 814   1              //              flag_dis = 0;
 815   1              //      }
 816   1      
 817   1              //      if (qtis == 15 && flag_back == 0 && flag_black_white_take == 0 && color != 0)
 818   1              //      {
 819   1              //              step = 0;
 820   1              //              ii = 0;
 821   1              //              switch (color)
 822   1              //              {
 823   1              //                      case YELLOW:Fast_forward(12);turn_left_90();break;
 824   1              //                      case WHITE:Fast_forward(15);turn_left_45();break;
 825   1              //                      case RED:Fast_forward(15);break;
 826   1              //                      case BLACK:Fast_forward(15);turn_right_45();break;
 827   1              //                      case BLUE:Fast_forward(15);turn_right_90();break;
 828   1              //              }
 829   1              //              flag_put_color = 1;
 830   1              //      }
 831   1      
 832   1                      
 833   1              //      if (color == WHITE || color == RED || color == BLACK)
 834   1              //      {
 835   1              //              if ((qtis_color == 48 || qtis_color == 16 || qtis_color == 32) && color != 0 && flag_put_color == 1)
 836   1              //              {
 837   1              //                      flag_track = 0;
 838   1              //                      Fast_forward(5);
 839   1              //                      stop();
 840   1              //                      back(30);
 841   1              //                      turn_back();
 842   1              //                      flag_track = 1;
 843   1              //                      obj_count++;
 844   1              //                      step = 0;
 845   1              //                      flag_put_color = 0;
 846   1              //                      flag_obj = 0;
 847   1              //                      flag_back = 1;
 848   1              //                      ii = 0;
 849   1              //              }
 850   1              //      }
 851   1              //      if (color == YELLOW)
 852   1              //      {
 853   1              //              if (qtis_color == 32 && color != 0 && flag_put_color == 1)
 854   1              //              {
 855   1              //                      flag_track = 0;
 856   1              //                      Fast_forward(18);
 857   1              //                      for (turn_r_i = 0; turn_r_i < 3; turn_r_i++)
 858   1              //                      {
 859   1              //                              turn_r(1510, 1510);
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 15  

 860   1              //                      }
 861   1              //                      stop();
 862   1              //                      back(30);
 863   1              //                      turn_back();
 864   1              //                      flag_track = 1;
 865   1              //                      obj_count++;
 866   1              //                      step = 0;
 867   1              //                      flag_put_color = 0;
 868   1              //                      flag_obj = 0;
 869   1              //                      flag_back = 1;
 870   1              //                      ii = 0;
 871   1              //              }
 872   1      
 873   1              //              /*防止冲出地图*/
 874   1              //              if (qtis_color == 16 && qtis == 0 && color != 0 && flag_put_color == 1)
 875   1              //              {
 876   1              //                      flag_track = 0;
 877   1              //                      for (turn_r_i = 0; turn_r_i < 3; turn_r_i++)
 878   1              //                      {
 879   1              //                              turn_r(1510, 1510);
 880   1              //                      }
 881   1              //                      stop();
 882   1              //                      back(30);
 883   1              //                      turn_back();
 884   1              //                      flag_track = 1;
 885   1              //                      obj_count++;
 886   1              //                      step = 0;
 887   1              //                      flag_put_color = 0;
 888   1              //                      flag_obj = 0;
 889   1              //                      flag_back = 1;
 890   1              //                      ii = 0;
 891   1              //              }
 892   1              //      }
 893   1      
 894   1              //      if (color == BLUE)
 895   1              //      {
 896   1              //              if (qtis_color == 16 && color != 0 && flag_put_color == 1)
 897   1              //              {
 898   1      
 899   1              //                      flag_track = 0;
 900   1              //                      Fast_forward(18);
 901   1              //                      stop();
 902   1              //                      back(30);
 903   1              //                      turn_back();
 904   1              //                      flag_track = 1;
 905   1              //                      obj_count++;
 906   1              //                      step = 0;
 907   1              //                      flag_put_color = 0;
 908   1              //                      flag_obj = 0;
 909   1              //                      flag_back = 1;
 910   1              //                      ii = 0;
 911   1              //              }
 912   1              //              /*防止冲出地图*/
 913   1              //              if (qtis_color == 32 && qtis == 0 && color != 0 && flag_put_color == 1)
 914   1              //              {
 915   1      
 916   1              //                      flag_track = 0;
 917   1              //                      stop();
 918   1              //                      back(30);
 919   1              //                      turn_back();
 920   1              //                      flag_track = 1;
 921   1              //                      obj_count++;
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 16  

 922   1              //                      step = 0;
 923   1              //                      flag_put_color = 0;
 924   1              //                      flag_obj = 0;
 925   1              //                      flag_back = 1;
 926   1              //                      ii = 0;
 927   1              //              }
 928   1              //      }
 929   1      
 930   1              //      /* 4qits */
 931   1              //      // 黑色物块放到对应位置，flag_back置1
 932   1              //      //  if(flag_black == 1)
 933   1              //      //  {
 934   1              //      //      if (step >= 45)
 935   1              //      //      {
 936   1              //      //              stop();
 937   1              //      //              back(30);
 938   1              //      //              turn_back();
 939   1              //      //              flag_black = 0;
 940   1              //      //              obj_count++;
 941   1              //      //              step = 0;
 942   1              //      //              flag_put_color = 0;
 943   1              //      //              flag_obj = 0;
 944   1              //      //              flag_back = 1;
 945   1              //      //              ii = 0;
 946   1              //      //      }
 947   1              //      //  }
 948   1      
 949   1              //      // if(step >= 30)
 950   1              //      // {
 951   1              //      //      if (qtis == 0)
 952   1              //      //              ii++;
 953   1              //      //      if (ii > 2 && qtis == 0 && flag_black == 0)
 954   1              //      //      {
 955   1              //      //              stop();
 956   1              //      //              back(30);
 957   1              //      //              turn_back();
 958   1              //      //              obj_count++;
 959   1              //      //              step = 0;
 960   1              //      //              flag_obj = 0;
 961   1              //      //              flag_back = 1;
 962   1              //      //              ii = 0;
 963   1              //      //      }
 964   1              //      // }
 965   1      
 966   1              //      //  if ((qtis_color == 16 || qtis_color == 32 || qtis_color == 48) && flag_put_color == 1)
 967   1              //      //  {
 968   1              //      //      stop();
 969   1              //      //      Fast_forward(15);
 970   1              //      //      back(30);
 971   1              //      //      turn_back();
 972   1              //      //      obj_count++;
 973   1              //      //      step = 0;
 974   1              //      //      flag_put_color = 0;
 975   1              //      //      flag_obj = 0;
 976   1              //      //      flag_back = 1;
 977   1              //      //      ii = 0;
 978   1              //      //  }
 979   1      
 980   1              //      if (qtis == 15 && flag_back == 1 && color != 0)
 981   1              //      {
 982   1              //              flag_color = 1;
 983   1              //              flag_back = 0;
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 17  

 984   1              //              step = 0;
 985   1              //              switch (color)
 986   1              //              {
 987   1              //                      case YELLOW:Fast_forward(12);turn_right_90();break;
 988   1              //                      case WHITE:Fast_forward(20);turn_right_45();break;
 989   1              //                      case RED:Fast_forward(15);break;
 990   1              //                      case BLACK:Fast_forward(18);turn_left_45();break;
 991   1              //                      case BLUE:Fast_forward(12);turn_left_90();break;
 992   1              //                      default:break;
 993   1              //              }
 994   1              //              color = 0;
 995   1              //              Fast_forward(40);
 996   1              //              if(obj_count != 2)
 997   1              //              {
 998   1              //                      turn_back();
 999   1              //              }
1000   1              //              flag_black_white_take = 1;
1001   1              //      }
1002   1      
1003   1              //      if(obj_count == 2 && step > 180)
1004   1              //      {
1005   1              //              step = 0;
1006   1              //              stop();
1007   1              //              break;
1008   1                              
1009   1              //      }
1010   1              // }
1011   1              // while(1)
1012   1              // {
1013   1              //      stop();
1014   1              // }
1015   1      }
*** WARNING C280 IN LINE 26 OF src\main.c: 'i': unreferenced local variable
1016          
1017          void tracking(void)
1018          {
1019   1              P0 = 0xff;              //检测黑线                                                                                                                   
1020   1              qtis = P0 & 0x0f;       //读取4个巡线传感器的值
1021   1              qtis_color = P0 & 0x30;         //两个qti放物块
1022   1              Fast_forward(1);//前进一小步
1023   1              switch(qtis)    //按照4个巡线传感器的值执行移动指令，巡线
1024   1              {
1025   2                      case 1:step++;turn(1550,1550);break;      //大幅向右转
1026   2                      case 2:step++;break;     
1027   2                      case 3:step++;turn(1550,1500);break;      //小幅向右转
1028   2                      case 8:step++;turn(1450,1450);break;      //大幅向左转
1029   2                      case 4:step++;break;
1030   2                      case 12:step++;turn(1500,1450);break;     //小幅向左转
1031   2                      case 5:step++;break;
1032   2                      case 6:step++;break;
1033   2                      case 7:step++;break;
1034   2                      case 10:step++;break;
1035   2                      case 13:step++;break;
1036   2                      case 14:step++;break;
1037   2                      case 15:Fast_forward(6);break;    //向前2小步                       
1038   2              }
1039   1      }
1040          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2077    ----
C51 COMPILER V9.54   MAIN                                                                  10/23/2025 17:22:25 PAGE 18  

   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     37      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
