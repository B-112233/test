C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil5\C51\BIN\C51.EXE src\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\System;.\src;.\Hardware) DEBU
                    -G OBJECTEXTEND PRINT(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <AT89X52.H>     
   2          #include <Boebot.h>
   3          #include "motor.h"
   4          #include "uart.h"
   5          #include "ultrasonic.h"
   6          #include "tcs230.h"
   7          
   8          void tracking(void);
   9          
  10          int qtis, qtis_color, step = 0;
  11          unsigned char flag = 0, flag_t = 1, flag_color = 1, flag_put_color = 0,
  12                                    flag_back = 1, flag_dis = 1, 
  13                                    flag_black = 0, flag_obj = 0, flag_obj_t = 0,
  14                                    flag_test_color = 0, flag_turn_r = 0,
  15                                    flag_right = 0, flag_left = 0,
  16                                    flag_black_white_take = 1, flag_take_back = 0, flag_con = 0,
  17                                    flag_bw_back = 0, flag_bw_color = 0, flag_track = 1, flag_interval = 0,
  18                                    flag_interval_step = 0, flag_put = 0, flag_turn = 0;
  19                                    
  20          unsigned char obj_count = 0, put_obj_count = 0, take_obj_count = 0;
  21          
  22          void main(void)
  23          {
  24   1              unsigned char record = 0, j = 0, black_white_count = 0;
  25   1              int color, i, turn_r_count = 0, turn_r_i = 0;
  26   1              char ii = 0;
  27   1              unsigned int dis;
  28   1              uart_Init();    //初始化超声波
  29   1      
  30   1              //开始时向前走一段
  31   1              delay_nms(2000);
  32   1              Fast_forward(40);
  33   1      
  34   1              /*第一阶段 把物块搬回缓冲区或搬到指定位置*/
  35   1              while(1)
  36   1              {
  37   2                      if(flag_track == 1)
  38   2                      {
  39   3                              tracking();
  40   3                      }
  41   2      
  42   2                      if(flag_interval_step == 0)
  43   2                      {
  44   3                              if(qtis == 15 && flag_turn == 0)                                          
  45   3                              {
  46   4                                      step = 0;
  47   4                                      record++;
  48   4                                      flag_t = 1;
  49   4                                      switch(record)                          
  50   4                                      {
  51   5                                              case 1:Fast_forward(12);turn_left_90();Fast_forward(10);break;          //第一次到中心点左转90
  52   5                                              case 2:Fast_forward(12);turn_right_90();Fast_forward(10);flag_interval = 1;break;
  53   5                                              case 3:Fast_forward(15);turn_left_45();Fast_forward(10);break;
  54   5                                              case 4:Fast_forward(15);turn_right_45();Fast_forward(10);flag_interval = 1;break;       
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 2   

  55   5                                              case 5:Fast_forward(15);break;
  56   5                                              case 6:Fast_forward(15);flag_interval = 1;break;
  57   5                                              case 7:Fast_forward(15);turn_right_45();Fast_forward(10);break;            
  58   5                                              case 8:Fast_forward(15);turn_left_45();Fast_forward(10);flag_interval = 1;break;
  59   5                                              case 9:Fast_forward(10);turn_right_90();Fast_forward(10);break;          
  60   5                                              case 10:Fast_forward(12);turn_left_90();Fast_forward(10);flag_interval = 1;break;
  61   5                                      }
  62   4                                      
  63   4                                      if (record % 2 == 1 && record > 0)
  64   4                                      {
  65   5                                              flag_dis = 1;
  66   5                                              flag_color = 1;
  67   5                                      }
  68   4                                      else
  69   4                                      {
  70   5                                              flag_interval_step = 1;
  71   5                                              flag = 0;
  72   5                                              flag_dis = 0;
  73   5                                              flag_color = 0;
  74   5                                      }
  75   4                                      ii=0;
  76   4                              }
  77   3                      }
  78   2      
  79   2                      
  80   2      
  81   2                      if (flag_dis == 1)
  82   2                      {
  83   3                              InitTimer(); // 给超声波计时
  84   3                              dis = GetSonarDis();
  85   3                              if (dis > 5 && dis < 8)
  86   3                              {
  87   4                                      flag_obj = 1;
  88   4                              }
  89   3                              if (dis > 95 && dis < 110 && flag_obj == 1)
  90   3                              {
  91   4                                      dis = 0;
  92   4                              }
  93   3                      }
  94   2      
  95   2      
  96   2                      if (dis < 3 && flag_color == 1 && flag_dis == 1)
  97   2                      {
  98   3                              stop();
  99   3                              take_obj_count++;
 100   3                              if(take_obj_count == 3)
 101   3                              {
 102   4                                      flag_turn = 2;
 103   4                              }
 104   3                              flag_test_color = 1;
 105   3                              flag_color = 0;
 106   3                              flag_dis = 0;
 107   3                              flag_obj = 1;
 108   3                              color = get_color();
 109   3                              Fast_forward(50);
 110   3                      }
 111   2      
 112   2                      /* 放黄、红、蓝物块 */
 113   2                      if (flag_test_color)
 114   2                      {
 115   3                              if ((color == YELLOW && record == 1) ||
 116   3                                      (color == WHITE && record == 3) ||
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 3   

 117   3                                      (color == RED && record == 5) ||
 118   3                                      (color == BLACK && record == 7) ||
 119   3                                      (color == BLUE && record == 9))
 120   3                              {
 121   4                                      flag_put_color = 1;
 122   4                                      flag_turn = 1;
 123   4      
 124   4                                      if(color == WHITE || color == RED || color == BLACK)
 125   4                                      {
 126   5                                              if ((qtis_color == 48 || qtis_color == 16 || qtis_color == 32) && color != 0 && flag_put_color == 1)
 127   5                                              {
 128   6                                                      flag_track = 0;
 129   6                                                      stop();
 130   6                                                      back(30);
 131   6                                                      turn_back();
 132   6                                                      flag_track = 1;
 133   6                                                      obj_count++;
 134   6                                                      flag_put_color = 0;
 135   6                                                      flag_test_color = 0;
 136   6                                                      flag_obj_t = 1;
 137   6                                                      color = 0;
 138   6                                                      record++;
 139   6                                                      ii = 0;
 140   6                                              }
 141   5                                      }
 142   4                                      if(color == YELLOW)
 143   4                                      {
 144   5                                              if (qtis_color == 32 && color != 0 && flag_put_color == 1)
 145   5                                              {
 146   6                                                      flag_track = 0;
 147   6                                                      Fast_forward(18);
 148   6                                                      for(turn_r_i = 0; turn_r_i < 3; turn_r_i++)
 149   6                                                      {
 150   7                                                      turn_r(1510, 1510);
 151   7                                                      }
 152   6                                                      stop();
 153   6                                                      back(30);
 154   6                                                      turn_back();
 155   6                                                      flag_track = 1;
 156   6                                                      obj_count++;
 157   6                                                      flag_put_color = 0;
 158   6                                                      flag_test_color = 0;
 159   6                                                      flag_obj_t = 1;
 160   6                                                      color = 0;
 161   6                                                      record++;
 162   6                                              }
 163   5      
 164   5                                              /*防止冲出地图*/
 165   5                                              if (qtis_color == 16 && qtis == 0 && color != 0 && flag_put_color == 1)
 166   5                                              {
 167   6                                                      flag_track = 0;
 168   6                                                      for (turn_r_i = 0; turn_r_i < 3; turn_r_i++)
 169   6                                                      {
 170   7                                                              turn_r(1510, 1510);
 171   7                                                      }
 172   6                                                      stop();
 173   6                                                      back(30);
 174   6                                                      turn_back();
 175   6                                                      flag_track = 1;
 176   6                                                      obj_count++;
 177   6                                                      flag_put_color = 0;
 178   6                                                      flag_test_color = 0;
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 4   

 179   6                                                      flag_obj_t = 1;
 180   6                                                      color = 0;
 181   6                                                      record++;
 182   6                                              }
 183   5                                      }
 184   4      
 185   4                                      if(color == BLUE)
 186   4                                      {
 187   5                                              if (qtis_color == 16 && color != 0 && flag_put_color == 1)
 188   5                                              {
 189   6                                                      
 190   6                                                      flag_track = 0;
 191   6                                                      Fast_forward(18);
 192   6                                                      stop();
 193   6                                                      back(30);
 194   6                                                      turn_back();
 195   6                                                      flag_track = 1;
 196   6                                                      obj_count++;
 197   6                                                      flag_put_color = 0;
 198   6                                                      flag_test_color = 0;
 199   6                                                      flag_obj_t = 1;
 200   6                                                      color = 0;
 201   6                                                      record++;
 202   6                                              }
 203   5                                              /*防止冲出地图*/
 204   5                                              if (qtis_color == 32 && qtis == 0 && color != 0 && flag_put_color == 1)
 205   5                                              {
 206   6      
 207   6                                                      flag_track = 0;
 208   6                                                      stop();
 209   6                                                      back(30);
 210   6                                                      turn_back();
 211   6                                                      flag_track = 1;
 212   6                                                      obj_count++;
 213   6                                                      flag_put_color = 0;
 214   6                                                      flag_test_color = 0;
 215   6                                                      flag_obj_t = 1;
 216   6                                                      color = 0;
 217   6                                                      record++;
 218   6                                              }
 219   5                                      }
 220   4                                      
 221   4                                      /* 4 qtis */
 222   4                                      // if (qtis == 0)
 223   4                                      //      ii++;
 224   4                                      // if (ii > 2 && qtis == 0 && color != 0)
 225   4                                      // {
 226   4                                      //      back(30);
 227   4                                      //      turn_back();
 228   4                                      //      obj_count++;
 229   4                                      //      flag_test_color = 0;
 230   4                                      //      color = 0;
 231   4                                      //      ii = 0;
 232   4                                      // }
 233   4                              }
 234   3                              else
 235   3                              {
 236   4                                      Fast_forward(20);
 237   4                                      turn_back();
 238   4                                      flag_test_color = 0;
 239   4                              }
 240   3                      }
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 5   

 241   2                      
 242   2      
 243   2      
 244   2                      if (record % 2 == 1 && flag_obj == 0)
 245   2                      {
 246   3                              if (qtis == 0)
 247   3                                      ii++;
 248   3                              if (ii > 2 && (qtis == 0 || qtis == 10 || qtis == 5 || qtis == 9 || qtis == 11 || qtis == 13) && flag_t
             - == 1)
 249   3                              {
 250   4                                      flag_t = 0;
 251   4                                      flag_turn = 1;
 252   4                                      Fast_forward(60);
 253   4                                      turn_back();
 254   4                                      record++;
 255   4                                      ii = 0;
 256   4                              }
 257   3                      }
 258   2                      
 259   2                      // if(qtis == 15 && flag_put == 1)
 260   2                      // {
 261   2                      //      put_obj_count++;
 262   2                      //      step = 0;
 263   2                      //      switch(put_obj_count)                           
 264   2                      //      {
 265   2                      //              case 1:turn_right_90();turn_right_45();break;
 266   2                      //              case 2:turn_left_120();flag_put = 0;break;
 267   2                      //              case 3:turn_left_90();turn_left_45();break;
 268   2                      //              case 4:turn_right_120();flag_put = 0;break;
 269   2                      //              case 5:stop();back(30);turn_back();break;
 270   2                      //      }
 271   2                      // }
 272   2      
 273   2                      // if(step > 15 && put_obj_count == 1 && flag_put == 1)
 274   2                      // {
 275   2                      //      step = 0;
 276   2                      //      back(30);
 277   2                      //      turn_back_r();
 278   2                      //      flag_interval_step = 0;
 279   2                      //      flag_obj = 0;
 280   2                      //      flag = 1;
 281   2                      // }
 282   2      
 283   2                      // if (step > 15 && put_obj_count == 3 && flag_put == 1)
 284   2                      // {
 285   2                      //      step = 0; 
 286   2                      //      back(30);
 287   2                      //      turn_back();
 288   2                      //      flag_interval_step = 0;
 289   2                      //      flag_obj = 0;
 290   2                      //      flag = 1;
 291   2                      // }
 292   2      
 293   2                      /*把物体间隔放到缓冲区*/
 294   2                      if(record % 2 == 0 && record > 0 && flag == 0 && flag_obj == 1 && flag_interval == 1)
 295   2                      {
 296   3                              static unsigned char interval_step = 0;
 297   3                              if(step > (200 - j * 40)) 
 298   3                              {
 299   4                                      back(30);
 300   4                                      turn_back();
 301   4                                      flag_obj = 0;
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 6   

 302   4                                      flag = 1;
 303   4                                      step = 0;
 304   4                                      flag_interval = 0;
 305   4                                      j++;
 306   4                              }
 307   3      
 308   3                              flag_dis = 0;
 309   3                              flag_color = 0;
 310   3                      }
 311   2                      else if(record % 2 == 0 && record > 0 && flag == 0 && flag_turn == 1)
 312   2                      {
 313   3                              if(qtis == 15)
 314   3                              {
 315   4                                      step = 0;
 316   4                                      flag_t = 1;
 317   4                                      switch(record)                          
 318   4                                      {
 319   5                                              case 2:Fast_forward(12);turn_left_90();turn_left_45();Fast_forward(20);break;
 320   5                                              case 4:Fast_forward(15);turn_left_90();turn_left_45();Fast_forward(20);break;   
 321   5                                              case 6:Fast_forward(15);turn_back();turn_right_45();Fast_forward(20);break;
 322   5                                              case 8:Fast_forward(15);turn_left_45();turn_left_90();Fast_forward(20);break;
 323   5                                              case 10:Fast_forward(12);turn_left_90();Fast_forward(20);break;
 324   5                                      }
 325   4                                      record++;
 326   4                                      if (record % 2 == 1 && record > 0)
 327   4                                      {
 328   5                                              flag_dis = 1;
 329   5                                              flag_color = 1;
 330   5                                      }
 331   4                                      else
 332   4                                      {
 333   5                                              flag_interval_step = 1;
 334   5                                              flag = 0;
 335   5                                              flag_dis = 0;
 336   5                                              flag_color = 0;
 337   5                                      }
 338   4                                      ii = 0;
 339   4      
 340   4                                      flag_turn = 0;
 341   4                              }
 342   3                              // if(step > 120)
 343   3                              // {
 344   3                              //      step = 0;
 345   3                              //      turn_back();
 346   3                              //      flag_interval_step = 0;
 347   3                              //      flag_obj_t = 0;
 348   3                              //      flag_obj = 0;
 349   3                              //      flag = 1;
 350   3                              //      flag_dis = 0;
 351   3                              //      flag_color = 0;
 352   3                              // }
 353   3                      }
 354   2      
 355   2                      if (step > 20 && flag == 1 && flag_obj == 0)
 356   2                      {
 357   3                              step = 0;
 358   3                              flag_interval_step = 0;
 359   3                      }
 360   2      
 361   2                      if(take_obj_count == 3)
 362   2                      {
 363   3                              if(qtis == 15 && flag_turn == 3)
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 7   

 364   3                              {
 365   4                                      step = 0;
 366   4                                      switch(record)                          
 367   4                                      {
 368   5                                              case 2:Fast_forward(12);turn_left_90();Fast_forward(20);break;
 369   5                                              case 4:Fast_forward(15);turn_left_90();turn_left_45();Fast_forward(20);break;   
 370   5                                              case 6:Fast_forward(15);turn_back();Fast_forward(20);break;
 371   5                                              case 8:Fast_forward(15);turn_right_45();turn_right_90();Fast_forward(20);break;
 372   5                                              case 10:Fast_forward(12);turn_right_90();Fast_forward(20);break;
 373   5                                      }
 374   4                                      back(30);
 375   4                                      break;
 376   4                              }
 377   3                      }
 378   2      
 379   2      
 380   2                      // if((j + obj_count) == 3 && qtis == 15)                               
 381   2                      // {
 382   2                      //      // flag = 0;
 383   2                      //      // back(30);
 384   2                      //      turn_back();
 385   2                      //      break;
 386   2                      //      //turn_right_90();
 387   2                      //      //stop();
 388   2                      // }
 389   2      
 390   2              }
 391   1      
 392   1              
 393   1              /* 第二部分 判断颜色 搬到指定地点*/
 394   1              flag_dis = 1;   // 测距离标志位
 395   1              flag_black = 0; // 黑色物块标志位
 396   1              flag_color = 1; // 颜色检查标志位
 397   1              flag_obj = 0;   // 是否有物块
 398   1              flag_put_color = 0;             //放置物块标志位
 399   1              flag_track = 1;         //循迹标志位
 400   1              flag_interval_step = 1;
 401   1              ii = 0;
 402   1              if(obj_count != 3)
 403   1              {
 404   2                      while(1)
 405   2                      {
 406   3                              // 循迹
 407   3                              if(flag_track == 1)
 408   3                              {
 409   4                                      tracking();
 410   4                              }
 411   3      
 412   3                              if (flag_dis == 1)
 413   3                              {
 414   4                                      InitTimer(); // 给超声波计时
 415   4                                      dis = GetSonarDis();
 416   4                                      
 417   4                                      if (dis > 6 && dis < 20)
 418   4                                      {
 419   5                                              flag_obj = 1;
 420   5                                      }
 421   4      
 422   4                                      if (dis > 95 && flag_obj == 1)
 423   4                                      {
 424   5                                              dis = 0;
 425   5                                      }
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 8   

 426   4                              }
 427   3      
 428   3                              // dis <= 2时判断颜色，获取颜色
 429   3                              if(dis < 3 && flag_color == 1 && flag_dis == 1)
 430   3                              {
 431   4                                      stop();
 432   4                                      color = get_color();
 433   4                                      turn_back();
 434   4                                      Fast_forward(20);
 435   4                                      flag_obj = 1;
 436   4                                      flag_color = 0;
 437   4                                      flag_back = 0;
 438   4                                      flag_dis = 0;
 439   4                              }
 440   3      
 441   3                              if (step > 10 && flag_back == 0 && flag_obj == 0)
 442   3                              {
 443   4                                      step = 0;
 444   4                                      flag_interval_step = 0;
 445   4                              }
 446   3      
 447   3                              if(flag_interval_step == 0)
 448   3                              {
 449   4                                      if (qtis == 15 && flag_back == 0)
 450   4                                      {
 451   5                                              step = 0;
 452   5                                              ii = 0;
 453   5                                              switch (color)
 454   5                                              {
 455   6                                                      case YELLOW:Fast_forward(12);turn_left_90();break;
 456   6                                                      case WHITE:Fast_forward(15);turn_left_45();break;
 457   6                                                      case RED:Fast_forward(15);break;
 458   6                                                      case BLACK:Fast_forward(15);turn_right_45();break;
 459   6                                                      case BLUE:Fast_forward(15);turn_right_90();break;
 460   6                                              }
 461   5                                              flag_put_color = 1;
 462   5                                      }
 463   4                              }
 464   3                              
 465   3                              //放到对应位置，flag_back置1
 466   3                              // if(flag_black == 1)
 467   3                              // {
 468   3                              //      if (step >= 55)
 469   3                              //      {
 470   3                              //              back(30);
 471   3                              //              turn_back();
 472   3                              //              step = 0;
 473   3                              //              flag_back = 1;
 474   3                              //              flag_black = 0;
 475   3                              //      }
 476   3                              // }
 477   3                              
 478   3      
 479   3                              if(step >= 30)
 480   3                              {
 481   4                                      // if ((qtis_color == 16 || qtis_color == 32 || qtis_color == 48) && flag_put_color == 1)
 482   4                                      // {
 483   4                                      //      stop();
 484   4                                      //      Fast_forward(15);
 485   4                                      //      back(30);
 486   4                                      //      turn_back();
 487   4                                      //      obj_count++;
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 9   

 488   4                                      //      step = 0;
 489   4                                      //      flag_put_color = 0;
 490   4                                      //      flag_obj = 0;
 491   4                                      //      flag_back = 1;
 492   4                                      //      ii = 0;
 493   4                                      // }
 494   4                                      if (color == WHITE || color == RED || color == BLACK)
 495   4                                      {
 496   5                                              if ((qtis_color == 48 || qtis_color == 16 || qtis_color == 32) && color != 0 && flag_put_color == 1)
 497   5                                              {
 498   6                                                      flag_track = 0;
 499   6                                                      Fast_forward(3);
 500   6                                                      stop();
 501   6                                                      back(30);
 502   6                                                      turn_back();
 503   6                                                      flag_track = 1;
 504   6                                                      obj_count++;
 505   6                                                      step = 0;
 506   6                                                      flag_obj = 0;
 507   6                                                      flag_back = 1;
 508   6                                                      flag_put_color = 0;
 509   6                                              }
 510   5                                      }
 511   4      
 512   4                                      if (color == YELLOW)
 513   4                                      {
 514   5                                              if (qtis_color == 32 && color != 0 && flag_put_color == 1)
 515   5                                              {
 516   6                                                      flag_track = 0;
 517   6                                                      Fast_forward(15);
 518   6                                                      for (turn_r_i = 0; turn_r_i < 3; turn_r_i++)
 519   6                                                      {
 520   7                                                              turn_r(1510, 1510);
 521   7                                                      }
 522   6                                                      stop();
 523   6                                                      back(30);
 524   6                                                      turn_back();
 525   6                                                      flag_track = 1;
 526   6                                                      obj_count++;
 527   6                                                      step = 0;
 528   6                                                      flag_obj = 0;
 529   6                                                      flag_back = 1;
 530   6                                                      flag_put_color = 0;
 531   6                                              }
 532   5      
 533   5                                              /*防止冲出地图*/
 534   5                                              if (qtis_color == 16 && qtis == 0 && color != 0 && flag_put_color == 1)
 535   5                                              {
 536   6                                                      flag_track = 0;
 537   6                                                      for (turn_r_i = 0; turn_r_i < 3; turn_r_i++)
 538   6                                                      {
 539   7                                                              turn_r(1510, 1510);
 540   7                                                      }
 541   6                                                      stop();
 542   6                                                      back(30);
 543   6                                                      turn_back();
 544   6                                                      flag_track = 1;
 545   6                                                      obj_count++;
 546   6                                                      step = 0;
 547   6                                                      flag_obj = 0;
 548   6                                                      flag_back = 1;
 549   6                                                      flag_put_color = 0;
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 10  

 550   6                                              }
 551   5                                      }
 552   4      
 553   4                                      if (color == BLUE)
 554   4                                      {
 555   5                                              if (qtis_color == 16 && color != 0 && flag_put_color == 1)
 556   5                                              {
 557   6      
 558   6                                                      flag_track = 0;
 559   6                                                      Fast_forward(10);
 560   6                                                      stop();
 561   6                                                      back(30);
 562   6                                                      turn_back();
 563   6                                                      flag_track = 1;
 564   6                                                      obj_count++;
 565   6                                                      step = 0;
 566   6                                                      flag_obj = 0;
 567   6                                                      flag_back = 1;
 568   6                                                      flag_put_color = 0;
 569   6                                              }
 570   5                                              /*防止冲出地图*/
 571   5                                              if (qtis_color == 32 && qtis == 0 && color != 0 && flag_put_color == 1)
 572   5                                              {
 573   6      
 574   6                                                      flag_track = 0;
 575   6                                                      stop();
 576   6                                                      back(30);
 577   6                                                      turn_back();
 578   6                                                      flag_track = 1;
 579   6                                                      obj_count++;
 580   6                                                      step = 0;
 581   6                                                      flag_obj = 0;
 582   6                                                      flag_back = 1;
 583   6                                                      flag_put_color = 0;
 584   6                                                      flag_test_color = 0;
 585   6                                              }
 586   5                                      }
 587   4      
 588   4                                      /* 4qtis */
 589   4                                      // if (qtis == 0)
 590   4                                      //      ii++;
 591   4                                      // if (ii > 2 && qtis == 0)
 592   4                                      // {
 593   4                                      //      back(30);
 594   4                                      //      turn_back();
 595   4                                      //      obj_count++;
 596   4                                      //      step = 0;
 597   4                                      //      flag_obj = 0;
 598   4                                      //      flag_back = 1;
 599   4                                      //      ii = 0;
 600   4                                      // }
 601   4                              }
 602   3                              
 603   3                              if(flag_interval_step == 0)
 604   3                              {
 605   4                                      if (qtis == 15 && flag_back == 1)
 606   4                                      {
 607   5                                              flag_dis = 1;
 608   5                                              flag_color = 1;
 609   5                                              step = 0;
 610   5                                              switch (color)
 611   5                                              {
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 11  

 612   6                                                      case YELLOW:Fast_forward(12);turn_right_90();break;
 613   6                                                      case WHITE:Fast_forward(20);turn_right_45();break;
 614   6                                                      case RED:Fast_forward(15);break;
 615   6                                                      case BLACK:Fast_forward(18);turn_left_45();break;
 616   6                                                      case BLUE:Fast_forward(12);turn_left_90();break;
 617   6                                              }
 618   5      
 619   5                                              color = 0;
 620   5                                              if (obj_count == 3 && step > 10) // 搬完三个回来，准备搬运黑白
 621   5                                              {
 622   6                                                      step = 0;
 623   6                                                      break;
 624   6                                              }
 625   5                                      }
 626   4                              }
 627   3                      }
 628   2              }
 629   1              
 630   1      
 631   1              /*第三阶段 搬运黑白物块*/
 632   1              // flag_dis = 0;        // 测距离标志位
 633   1              // flag_black = 0; // 黑色物块标志位
 634   1              // flag_color = 0; // 颜色检查标志位
 635   1              // flag_obj = 0;        // 是否有物块
 636   1              // flag_black_white_take = 1;   //标志取到黑白物块
 637   1              // flag_back = 0;               //返回标志位
 638   1              // flag_track = 1;
 639   1              // obj_count = 0;
 640   1              // color = 0;
 641   1              // dis = 100;
 642   1              // ii = 0;
 643   1              // step = 0;
 644   1              // turn_back();
 645   1              // while(1)
 646   1              // {
 647   1              //      // 循迹
 648   1              //      if(flag_track == 1)
 649   1              //      {
 650   1              //              tracking();
 651   1              //      }
 652   1      
 653   1              //      if(qtis == 15 && flag_black_white_take == 1)
 654   1              //      {
 655   1              //              Fast_forward(12);
 656   1              //              turn_right_90();
 657   1              //              flag_turn_r = 1;
 658   1              //      }
 659   1                      
 660   1              //      if(flag_turn_r == 1)
 661   1              //      {
 662   1              //              turn_r_count = 0;
 663   1              //              for(i=0; i < 200; i++)               //利用超声波搜索第五个物块500
 664   1              //              {                       
 665   1              //                      InitTimer();  //定时器初始化
 666   1              //                      dis = GetSonarDis(); //启动超声波
 667   1              //                      //printf("m = : %d\n",m);
 668   1              //                      delay_nms(100);
 669   1              //                      turn_r(1540,1540); //微转动
 670   1                                      
 671   1              //                      if(dis >= 10 && dis < 20)
 672   1              //                      {
 673   1              //                              turn_r_count = i;
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 12  

 674   1              //                              if(black_white_count > 5)  //有几次次检测到物块，则前进80步，取下物块。
 675   1              //                              {
 676   1              //                                      stop();
 677   1              //                                      Fast_forward(98);
 678   1              //                                      flag_black_white_take = 0;
 679   1              //                                      flag_bw_back = 1;
 680   1              //                                      break;
 681   1              //                              }
 682   1              //                              black_white_count++;
 683   1              //                      }
 684   1              //              }
 685   1              //              flag_turn_r = 0;
 686   1              //      }
 687   1              //      if (turn_r_count > 30)
 688   1              //      {
 689   1              //              flag_left = 1;
 690   1              //              flag_right = 0;
 691   1              //      }
 692   1              //      else
 693   1              //      {
 694   1              //              flag_right = 1;
 695   1              //              flag_left = 0;
 696   1              //      }
 697   1      
 698   1              //      if(qtis == 15 && flag_bw_back == 1)
 699   1              //      {
 700   1              //              step = 0;
 701   1              //              flag_bw_color = 1;
 702   1              //              if (flag_right == 1)
 703   1              //              {
 704   1              //                      Fast_forward(12);
 705   1              //                      turn_right_90();
 706   1              //              }
 707   1              //              else if (flag_left == 1)
 708   1              //              {
 709   1              //                      Fast_forward(12);
 710   1              //                      turn_left_90();
 711   1              //              }
 712   1              //              flag_bw_back = 0;
 713   1              //      }
 714   1      
 715   1              //      if (qtis == 15 && flag_bw_color == 1 && step > 10)
 716   1              //      {
 717   1              //              step = 0;
 718   1              //              if (flag_right == 1)
 719   1              //              {
 720   1              //                      Fast_forward(20);
 721   1              //                      turn_right_120();
 722   1              //                      Fast_forward(40);
 723   1              //                      stop();
 724   1              //                      back(30);
 725   1              //                      flag_con = 1;
 726   1              //                      flag_dis = 1;
 727   1              //                      flag_color = 1;
 728   1              //              }
 729   1              //              else if (flag_left == 1)
 730   1              //              {
 731   1              //                      Fast_forward(20);
 732   1              //                      turn_left_120();
 733   1              //                      Fast_forward(40);
 734   1              //                      stop();
 735   1              //                      back(30);
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 13  

 736   1              //                      flag_con = 1;
 737   1              //                      flag_dis = 1;
 738   1              //                      flag_color = 1;
 739   1              //              }
 740   1              //              flag_bw_color = 0;
 741   1              //      }
 742   1              //      if (flag_dis == 1 && flag_bw_color == 0)
 743   1              //      {
 744   1              //              InitTimer(); // 给超声波计时
 745   1              //              dis = GetSonarDis();
 746   1              //              if (dis > 5 && dis < 20)
 747   1              //              {
 748   1              //                      flag_obj = 1;
 749   1              //              }
 750   1      
 751   1              //              if (dis > 90 && flag_obj == 1)
 752   1              //              {
 753   1              //                      dis = 0;
 754   1              //              }
 755   1              //      }
 756   1      
 757   1              //      //判断颜色，获取颜色
 758   1              //      if(dis <= 2 && flag_color == 1 && flag_dis == 1 && flag_con == 1)
 759   1              //      {
 760   1              //              stop();
 761   1              //              color = get_color();
 762   1              //              if(color == BLACK)
 763   1              //              {
 764   1              //                      flag_black = 1;
 765   1              //              }
 766   1              //              flag_con = 0;
 767   1              //              flag_obj = 1;
 768   1              //              flag_color = 0;
 769   1              //              flag_back = 0;
 770   1              //              flag_dis = 0;
 771   1              //      }
 772   1      
 773   1              //      if (qtis == 15 && flag_back == 0 && flag_black_white_take == 0 && color != 0)
 774   1              //      {
 775   1              //              step = 0;
 776   1              //              ii = 0;
 777   1              //              switch (color)
 778   1              //              {
 779   1              //                      case YELLOW:Fast_forward(12);turn_left_90();break;
 780   1              //                      case WHITE:Fast_forward(15);turn_left_45();break;
 781   1              //                      case RED:Fast_forward(15);break;
 782   1              //                      case BLACK:Fast_forward(15);turn_right_45();break;
 783   1              //                      case BLUE:Fast_forward(15);turn_right_90();break;
 784   1              //              }
 785   1              //              flag_put_color = 1;
 786   1              //      }
 787   1      
 788   1                      
 789   1              //      if (color == WHITE || color == RED || color == BLACK)
 790   1              //      {
 791   1              //              if ((qtis_color == 48 || qtis_color == 16 || qtis_color == 32) && color != 0 && flag_put_color == 1)
 792   1              //              {
 793   1              //                      flag_track = 0;
 794   1              //                      stop();
 795   1              //                      back(30);
 796   1              //                      turn_back();
 797   1              //                      flag_track = 1;
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 14  

 798   1              //                      obj_count++;
 799   1              //                      step = 0;
 800   1              //                      flag_put_color = 0;
 801   1              //                      flag_obj = 0;
 802   1              //                      flag_back = 1;
 803   1              //                      ii = 0;
 804   1              //              }
 805   1              //      }
 806   1              //      if (color == YELLOW)
 807   1              //      {
 808   1              //              if (qtis_color == 32 && color != 0 && flag_put_color == 1)
 809   1              //              {
 810   1              //                      flag_track = 0;
 811   1              //                      Fast_forward(18);
 812   1              //                      for (turn_r_i = 0; turn_r_i < 3; turn_r_i++)
 813   1              //                      {
 814   1              //                              turn_r(1510, 1510);
 815   1              //                      }
 816   1              //                      stop();
 817   1              //                      back(30);
 818   1              //                      turn_back();
 819   1              //                      flag_track = 1;
 820   1              //                      obj_count++;
 821   1              //                      step = 0;
 822   1              //                      flag_put_color = 0;
 823   1              //                      flag_obj = 0;
 824   1              //                      flag_back = 1;
 825   1              //                      ii = 0;
 826   1              //              }
 827   1      
 828   1              //              /*防止冲出地图*/
 829   1              //              if (qtis_color == 16 && qtis == 0 && color != 0 && flag_put_color == 1)
 830   1              //              {
 831   1              //                      flag_track = 0;
 832   1              //                      for (turn_r_i = 0; turn_r_i < 3; turn_r_i++)
 833   1              //                      {
 834   1              //                              turn_r(1510, 1510);
 835   1              //                      }
 836   1              //                      stop();
 837   1              //                      back(30);
 838   1              //                      turn_back();
 839   1              //                      flag_track = 1;
 840   1              //                      obj_count++;
 841   1              //                      step = 0;
 842   1              //                      flag_put_color = 0;
 843   1              //                      flag_obj = 0;
 844   1              //                      flag_back = 1;
 845   1              //                      ii = 0;
 846   1              //              }
 847   1              //      }
 848   1      
 849   1              //      if (color == BLUE)
 850   1              //      {
 851   1              //              if (qtis_color == 16 && color != 0 && flag_put_color == 1)
 852   1              //              {
 853   1      
 854   1              //                      flag_track = 0;
 855   1              //                      Fast_forward(18);
 856   1              //                      stop();
 857   1              //                      back(30);
 858   1              //                      turn_back();
 859   1              //                      flag_track = 1;
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 15  

 860   1              //                      obj_count++;
 861   1              //                      step = 0;
 862   1              //                      flag_put_color = 0;
 863   1              //                      flag_obj = 0;
 864   1              //                      flag_back = 1;
 865   1              //                      ii = 0;
 866   1              //              }
 867   1              //              /*防止冲出地图*/
 868   1              //              if (qtis_color == 32 && qtis == 0 && color != 0 && flag_put_color == 1)
 869   1              //              {
 870   1      
 871   1              //                      flag_track = 0;
 872   1              //                      stop();
 873   1              //                      back(30);
 874   1              //                      turn_back();
 875   1              //                      flag_track = 1;
 876   1              //                      obj_count++;
 877   1              //                      step = 0;
 878   1              //                      flag_put_color = 0;
 879   1              //                      flag_obj = 0;
 880   1              //                      flag_back = 1;
 881   1              //                      ii = 0;
 882   1              //              }
 883   1              //      }
 884   1      
 885   1              //      /* 4qits */
 886   1      
 887   1              //      // 黑色物块放到对应位置，flag_back置1
 888   1              //      //  if(flag_black == 1)
 889   1              //      //  {
 890   1              //      //      if (step >= 45)
 891   1              //      //      {
 892   1              //      //              stop();
 893   1              //      //              back(30);
 894   1              //      //              turn_back();
 895   1              //      //              flag_black = 0;
 896   1              //      //              obj_count++;
 897   1              //      //              step = 0;
 898   1              //      //              flag_put_color = 0;
 899   1              //      //              flag_obj = 0;
 900   1              //      //              flag_back = 1;
 901   1              //      //              ii = 0;
 902   1              //      //      }
 903   1              //      //  }
 904   1      
 905   1              //      // if(step >= 30)
 906   1              //      // {
 907   1              //      //      if (qtis == 0)
 908   1              //      //              ii++;
 909   1              //      //      if (ii > 2 && qtis == 0 && flag_black == 0)
 910   1              //      //      {
 911   1              //      //              stop();
 912   1              //      //              back(30);
 913   1              //      //              turn_back();
 914   1              //      //              obj_count++;
 915   1              //      //              step = 0;
 916   1              //      //              flag_obj = 0;
 917   1              //      //              flag_back = 1;
 918   1              //      //              ii = 0;
 919   1              //      //      }
 920   1              //      // }
 921   1      
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 16  

 922   1              //      //  if ((qtis_color == 16 || qtis_color == 32 || qtis_color == 48) && flag_put_color == 1)
 923   1              //      //  {
 924   1              //      //      stop();
 925   1              //      //      Fast_forward(15);
 926   1              //      //      back(30);
 927   1              //      //      turn_back();
 928   1              //      //      obj_count++;
 929   1              //      //      step = 0;
 930   1              //      //      flag_put_color = 0;
 931   1              //      //      flag_obj = 0;
 932   1              //      //      flag_back = 1;
 933   1              //      //      ii = 0;
 934   1              //      //  }
 935   1      
 936   1                      
 937   1                      
 938   1              //      if (qtis == 15 && flag_back == 1 && color != 0)
 939   1              //      {
 940   1              //              flag_color = 1;
 941   1              //              flag_back = 0;
 942   1              //              step = 0;
 943   1              //              switch (color)
 944   1              //              {
 945   1              //                      case YELLOW:Fast_forward(12);turn_right_90();break;
 946   1              //                      case WHITE:Fast_forward(20);turn_right_45();break;
 947   1              //                      case RED:Fast_forward(15);break;
 948   1              //                      case BLACK:Fast_forward(18);turn_left_45();break;
 949   1              //                      case BLUE:Fast_forward(12);turn_left_90();break;
 950   1              //                      default:break;
 951   1              //              }
 952   1              //              color = 0;
 953   1              //              Fast_forward(40);
 954   1              //              if(obj_count != 2)
 955   1              //              {
 956   1              //                      turn_back();
 957   1              //              }
 958   1              //              flag_black_white_take = 1;
 959   1              //      }
 960   1      
 961   1              //      if(obj_count == 2 && step > 30)
 962   1              //      {
 963   1              //              step = 0;
 964   1              //              stop();
 965   1              //              break;
 966   1                              
 967   1              //      }
 968   1              // }
 969   1              // while(1)
 970   1              // {
 971   1              //      stop();
 972   1              // }
 973   1      }
*** WARNING C280 IN LINE 296 OF src\main.c: 'interval_step': unreferenced local variable
*** WARNING C280 IN LINE 25 OF src\main.c: 'i': unreferenced local variable
 974          
 975          
 976          void tracking(void)
 977          {
 978   1              P0 = 0xff;              //检测黑线                                                                                                                   
 979   1              qtis = P0 & 0x0f;       //读取4个巡线传感器的值
 980   1              qtis_color = P0 & 0x30;         //两个qti放物块
 981   1              Fast_forward(1);//前进一小步
C51 COMPILER V9.54   MAIN                                                                  10/21/2025 19:36:06 PAGE 17  

 982   1              switch(qtis)    //按照4个巡线传感器的值执行移动指令，巡线
 983   1              {
 984   2                      case 1:step++;turn(1550,1550);break;      //大幅向右转
 985   2                      case 2:step++;break;     
 986   2                      case 3:step++;turn(1550,1500);break;      //小幅向右转
 987   2                      case 8:step++;turn(1450,1450);break;      //大幅向左转
 988   2                      case 4:step++;break;
 989   2                      case 12:step++;turn(1500,1450);break;     //小幅向左转
 990   2                      case 5:step++;break;
 991   2                      case 6:step++;break;
 992   2                      case 7:step++;break;
 993   2                      case 10:step++;break;
 994   2                      case 13:step++;break;
 995   2                      case 14:step++;break;
 996   2                      case 15:Fast_forward(6);break;    //向前2小步                       
 997   2              }
 998   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2478    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     33      14
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
